#!/bin/sh

# - pingdns rev.1
# -
# - written by deseven
# - check https://github.com/deseven/pingdns for updates or help

# random hosts list, taken from alexa top1m
hosts="1,google.com
2,facebook.com
3,youtube.com
4,baidu.com
5,yahoo.com
6,amazon.com
7,wikipedia.org
8,qq.com
9,taobao.com
10,twitter.com
11,google.co.in
12,live.com
13,sina.com.cn
14,linkedin.com
15,weibo.com
16,yahoo.co.jp
17,google.co.jp
18,ebay.com
19,yandex.ru
20,blogspot.com
21,vk.com
22,google.de
23,tmall.com
24,hao123.com
25,t.co
26,msn.com
27,instagram.com
28,bing.com
29,google.co.uk
30,amazon.co.jp
31,reddit.com
32,google.com.br
33,google.fr
34,sohu.com
35,aliexpress.com
36,ask.com
37,mail.ru
38,google.ru
39,onclickads.net
40,pinterest.com
41,wordpress.com
42,tumblr.com
43,paypal.com
44,imgur.com
45,xvideos.com
46,google.it
47,apple.com
48,microsoft.com
49,imdb.com
50,google.es
51,fc2.com
52,netflix.com
53,googleadservices.com
54,360.cn
55,stackoverflow.com
56,amazon.de
57,craigslist.org
58,google.ca
59,ok.ru
60,adcash.com
61,google.com.mx
62,diply.com
63,tianya.cn
64,google.com.hk
65,pornhub.com
66,alibaba.com
67,rakuten.co.jp
68,naver.com
69,adobe.com
70,amazon.co.uk
71,google.com.tr
72,xinhuanet.com
73,outbrain.com
74,xhamster.com
75,soso.com
76,detail.tmall.com
77,google.co.id
78,gmail.com
79,ebay.de
80,kat.cr
81,google.pl
82,people.com.cn
83,jd.com
84,go.com
85,google.com.au
86,cntv.cn
87,gmw.cn
88,nicovideo.jp
89,flipkart.com
90,cnn.com
91,dailymotion.com
92,bbc.co.uk
93,booking.com
94,github.com
95,googleusercontent.com
96,pixnet.net
97,dropbox.com
98,wikia.com
99,163.com
100,chinadaily.com.cn
101,google.com.tw
102,amazon.in
103,google.co.kr
104,youku.com
105,ebay.co.uk
106,livedoor.jp
107,huffingtonpost.com
108,indiatimes.com
109,alipay.com
110,nytimes.com
111,dailymail.co.uk
112,buzzfeed.com
113,amazon.cn
114,bbc.com
115,google.com.sa
116,china.com
117,blogger.com
118,google.nl
119,uol.com.br
120,chase.com
121,ettoday.net
122,espn.go.com
123,sogou.com
124,xnxx.com
125,google.com.eg
126,directrev.com
127,google.co.th
128,life.com.tw
129,blogspot.in
130,coccoc.com
131,dmm.co.jp
132,google.com.ar
133,ameblo.jp
134,popads.net
135,globo.com
136,tudou.com
137,bankofamerica.com
138,weather.com
139,google.com.pk
140,daum.net
141,twitch.tv
142,walmart.com
143,quora.com
144,amazon.fr
145,theguardian.com
146,flickr.com
147,youradexchange.com
148,yelp.com
149,bongacams.com
150,cnet.com
151,amazonaws.com
152,slideshare.net
153,redtube.com
154,aol.com
155,etsy.com
156,douban.com
157,pconline.com.cn
158,indeed.com
159,forbes.com
160,naver.jp
161,stackexchange.com
162,youporn.com
163,zillow.com
164,bycontext.com
165,google.co.za
166,adf.ly
167,about.com
168,snapdeal.com
169,tripadvisor.com
170,google.co.ve
171,wellsfargo.com
172,tubecup.com
173,soundcloud.com
174,amazon.it
175,microsoftonline.com
176,google.gr
177,kakaku.com
178,feedly.com
179,bp.blogspot.com
180,loading-delivery1.com
181,vimeo.com
182,ilividnewtab.com
183,leboncoin.fr
184,office365.com
185,goo.ne.jp
186,9gag.com
187,google.com.ua
188,vice.com
189,steampowered.com
190,wikihow.com
191,godaddy.com
192,bestbuy.com
193,deviantart.com
194,ikea.com
195,allegro.pl
196,businessinsider.com
197,avito.ru
198,salesforce.com
199,steamcommunity.com
200,livejournal.com
201,homedepot.com
202,w3schools.com
203,foxnews.com
204,mystart.com
205,theadgateway.com
206,onet.pl
207,mozilla.org
208,washingtonpost.com
209,taboola.com
210,google.be
211,themeforest.net
212,abs-cbnnews.com
213,ifeng.com
214,pixiv.net
215,target.com
216,doublepimp.com
217,mediafire.com
218,gfycat.com
219,wordpress.org
220,adplxmd.com
221,huanqiu.com
222,files.wordpress.com
223,warmportrait.com
224,nih.gov
225,secureserver.net
226,google.ro
227,softonic.com
228,google.com.sg
229,google.com.co
230,google.cn
231,americanexpress.com
232,whatsapp.com
233,telegraph.co.uk
234,zol.com.cn
235,gamer.com.tw
236,ups.com
237,doorblog.jp
238,blogspot.com.br
239,web.de
240,theladbible.com
241,terraclicks.com
242,google.com.ph
243,wikimedia.org
244,zhihu.com
245,archive.org
246,mercadolivre.com.br
247,google.se
248,google.at
249,groupon.com
250,wix.com
251,avg.com
252,github.io
253,force.com
254,usps.com
255,skype.com
256,bitauto.com
257,addthis.com
258,gmx.net
259,ign.com
260,comcast.net
261,office.com
262,shutterstock.com
263,orange.fr
264,youm7.com
265,amazon.es
266,google.pt
267,ndtv.com
268,contextualyield.com
269,xywy.com
270,bild.de
271,popcash.net
272,google.com.ng
273,rambler.ru
274,mashable.com
275,hurriyet.com.tr
276,xuite.net
277,sourceforge.net
278,kaskus.co.id
279,teepr.com
280,accuweather.com
281,hdfcbank.com
282,spiegel.de
283,wp.pl
284,espncricinfo.com
285,icicibank.com
286,hclips.com
287,chinatimes.com
288,goodreads.com
289,smzdm.com
290,caijing.com.cn
291,webmd.com
292,xfinity.com
293,google.com.pe
294,udn.com
295,ask.fm
296,google.ch
297,livejasmin.com
298,fbcdn.net
299,bloomberg.com
300,pclady.com.cn
301,bilibili.com
302,weebly.com
303,t-online.de
304,engadget.com
305,hp.com
306,nametests.com
307,capitalone.com
308,usatoday.com
309,speedtest.net
310,uptodown.com
311,ppomppu.co.kr
312,milliyet.com.tr
313,pandora.com
314,google.ae
315,quikr.com
316,wordreference.com
317,pchome.net
318,stumbleupon.com
319,wsj.com
320,detik.com
321,likes.com
322,jabong.com
323,seznam.cz
324,varzesh3.com
325,iqiyi.com
326,dmm.com
327,wow.com
328,amazon.ca
329,mailchimp.com
330,2ch.net
331,badoo.com
332,google.com.bd
333,extratorrent.cc
334,bleacherreport.com
335,webtretho.com
336,fedex.com
337,mobile01.com
338,google.cz
339,media.tumblr.com
340,hootsuite.com
341,ijreview.com
342,google.no
343,dell.com
344,mama.cn
345,1905.com
346,adidas.tmall.com
347,google.cl
348,mlb.com
349,1688.com
350,rediff.com
351,livedoor.biz
352,eastmoney.com
353,39.net
354,paytm.com
355,blog.jp
356,youth.cn
357,zendesk.com
358,samsung.com
359,watsons.tmall.com
360,rutracker.org
361,reimageplus.com
362,tube8.com
363,reuters.com
364,time.com
365,liputan6.com
366,google.ie
367,china.com.cn
368,google.dz
369,twimg.com
370,kickstarter.com
371,sabah.com.tr
372,spotify.com
373,tlbb8.com
374,onlinesbi.com
375,gsmarena.com
376,ltn.com.tw
377,verizonwireless.com
378,mydomainadvisor.com
379,impress.co.jp
380,hulu.com
381,kompas.com
382,slickdeals.net
383,sahibinden.com
384,haosou.com
385,nyaa.se
386,chaoshi.tmall.com
387,google.hu
388,newegg.com
389,goal.com
390,eksisozluk.com
391,buzzfil.net
392,answers.com
393,google.co.il
394,chaturbate.com
395,kouclo.com
396,att.com
397,expedia.com
398,sberbank.ru
399,ebay.in
400,tistory.com
401,yaolan.com
402,disqus.com
403,b5m.com
404,libero.it
405,lowes.com
406,liveinternet.ru
407,babytree.com
408,lifehacker.com
409,macys.com
410,ink361.com
411,thesaurus.com
412,ce.cn
413,gizmodo.com
414,infusionsoft.com
415,rt.com
416,styletv.com.cn
417,ebay.com.au
418,evernote.com
419,safetracking.net
420,lady8844.com
421,mega.co.nz
422,photobucket.com
423,livedoor.com
424,olx.in
425,blogfa.com
426,taleo.net
427,ameba.jp
428,akamaihd.net
429,marca.com
430,ck101.com
431,trello.com
432,stamplive.com
433,delta-homes.com
434,repubblica.it
435,bhaskar.com
436,justdial.com
437,naukri.com
438,oracle.com
439,citibank.com
440,gamefaqs.com
441,ebay.it
442,icloud.com
443,elpais.com
444,4shared.com
445,onedio.com
446,thefreedictionary.com
447,yandex.ua
448,xda-developers.com
449,gmarket.co.kr
450,putlocker.is
451,techcrunch.com
452,statsmobi.com
453,meetup.com
454,google.fi
455,xe.com
456,reference.com
457,airbnb.com
458,webssearches.com
459,hotels.com
460,uploaded.net
461,wunderground.com
462,nownews.com
463,stockstar.com
464,theverge.com
465,blogimg.jp
466,list.tmall.com
467,flirchi.com
468,rbc.ru
469,souq.com
470,google.dk
471,blogspot.com.es
472,kinopoisk.ru
473,retailmenot.com
474,baike.com
475,bukalapak.com
476,scribd.com
477,fiverr.com
478,battle.net
479,cloudfront.net
480,autohome.com.cn
481,realtor.com
482,asos.com
483,corriere.it
484,list-manage.com
485,independent.co.uk
486,duckduckgo.com
487,kohls.com
488,free.fr
489,google.com.vn
490,mobile.de
491,hatena.ne.jp
492,kayak.com
493,ero-advertising.com
494,elmundo.es
495,kijiji.ca
496,sabq.org
497,eyny.com
498,seesaa.net
499,tabelog.com
500,shopclues.com
501,urdupoint.com
502,google.sk
503,csdn.net
504,google.az
505,torrentz.eu
506,gap.com
507,nbcnews.com
508,woot.com
509,nmisr.com
510,hupu.com
511,youboy.com
512,kinogo.co
513,abril.com.br
514,eastday.com
515,zippyshare.com
516,rottentomatoes.com
517,playstation.com
518,ancestry.com
519,gameforge.com
520,hespress.com
521,doubleclick.net
522,surveymonkey.com
523,exoclick.com
524,ganji.com
525,hm.com
526,gazeta.pl
527,agoda.com
528,chinaz.com
529,npr.org
530,appledaily.com.tw
531,thepiratebay.la
532,glassdoor.com
533,blogspot.jp
534,youtube-mp3.org
535,trulia.com
536,nordstrom.com
537,shopify.com
538,nifty.com
539,haber7.com
540,nba.com
541,neobux.com
542,irctc.co.in
543,azlyrics.com
544,sears.com
545,kooora.com
546,savefrom.net
547,mercadolibre.com.ar
548,google.com.my
549,pinimg.com
550,allrecipes.com
551,okcupid.com
552,people.com
553,mirror.co.uk
554,eonline.com
555,connect5364.com
556,vnexpress.net
557,beeg.com
558,mbc.net
559,cnzz.com
560,4dsply.com
561,discovercard.com
562,mercadolibre.com.ve
563,lenovo.com
564,mixi.jp
565,so-net.ne.jp
566,pof.com
567,issuu.com
568,xunlei.com
569,haiwainet.cn
570,instructables.com
571,chip.de
572,torrentz.in
573,costco.com
574,tmz.com
575,intuit.com
576,change.org
577,jimdo.com
578,bet365.com
579,vcommission.com
580,6pm.com
581,jqw.com
582,shareba.com
583,slack.com
584,statcounter.com
585,abcnews.go.com
586,11st.co.kr
587,gigazine.net
588,myway.com
589,lazada.co.id
590,moneycontrol.com
591,ewt.cc
592,donga.com
593,qunar.com
594,sakura.ne.jp
595,verizon.com
596,aparat.com
597,58.com
598,bookmyshow.com
599,urbandictionary.com
600,tokopedia.com
601,lenta.ru
602,subscene.com
603,what-character-are-you.com
604,php.net
605,it168.com
606,olx.pl
607,youdao.com
608,nike.com
609,taringa.net
610,ashleyrnadison.com
611,epweike.com
612,blog.me
613,codecanyon.net
614,airtel.in
615,itmedia.co.jp
616,bodybuilding.com
617,zomato.com
618,gawker.com
619,lemonde.fr
620,streamcloud.eu
621,southwest.com
622,yts.to
623,interia.pl
624,elwatannews.com
625,zing.vn
626,focus.de
627,lefigaro.fr
628,subito.it
629,japanpost.jp
630,box.com
631,enet.com.cn
632,domaintools.com
633,timeanddate.com
634,ebay.fr
635,clien.net
636,bomb01.com
637,intoday.in
638,windows.com
639,aweber.com
640,asahi.com
641,overstock.com
642,slate.com
643,priceline.com
644,mystartsearch.com
645,youjizz.com
646,siteadvisor.com
647,gismeteo.ru
648,kotaku.com
649,ca.gov
650,suning.com
651,drudgereport.com
652,elmogaz.com
653,xbox.com
654,nikkei.com
655,mi.com
656,bhphotovideo.com
657,digikala.com
658,ptt01.cc
659,asus.com
660,ew.com
661,pantip.com
662,17ok.com
663,udemy.com
664,latimes.com
665,swagbucks.com
666,adme.ru
667,liveleak.com
668,rednet.cn
669,fidelity.com
670,onlylady.com
671,patch.com
672,cracked.com
673,houzz.com
674,cnbc.com
675,wetransfer.com
676,google.co.nz
677,ero-video.net
678,jrj.com.cn
679,medium.com
680,google.bg
681,douyutv.com
682,hostgator.com
683,zulily.com
684,voc.com.cn
685,constantcontact.com
686,cookpad.com
687,mynet.com
688,gamespot.com
689,makemytrip.com
690,weblio.jp
691,foodnetwork.com
692,gyazo.com
693,wetter.com
694,myfitnesspal.com
695,pch.com
696,yodobashi.com
697,semrush.com
698,workercn.cn
699,rightmove.co.uk
700,wikiwiki.jp
701,billdesk.com
702,zoho.com
703,absoluteclickscom.com
704,cdiscount.com
705,goo.gl
706,biglobe.ne.jp
707,squarespace.com
708,k618.cn
709,fanli.com
710,olx.com.br
711,gamepedia.com
712,java.com
713,prntscr.com
714,tnaflix.com
715,fitbit.com
716,pcmag.com
717,mercadolibre.com.mx
718,mynavi.jp
719,exblog.jp
720,custhelp.com
721,commentcamarche.net
722,sh.st
723,as.com
724,blogspot.mx
725,staticwebdom.com
726,nikkeibp.co.jp
727,leagueoflegends.com
728,bestadbid.com
729,android.com
730,emol.com
731,qklnk.co
732,united.com
733,chinaso.com
734,iflscience.com
735,sbnation.com
736,315che.com
737,bitly.com
738,e-hentai.org
739,doisongphapluat.com
740,friv.com
741,dianping.com
742,twoo.com
743,ytimg.com
744,superuser.com
745,nydailynews.com
746,ci123.com
747,ensonhaber.com
748,asana.com
749,lapatilla.com
750,r10.net
751,hdzog.com
752,globososo.com
753,shareasale.com
754,mackeeper.com
755,backpage.com
756,rapidgator.net
757,babycenter.com
758,thehindu.com
759,chron.com
760,sex.com
761,atwiki.jp
762,weather.gov
763,hatenablog.com
764,albawabhnews.com
765,ibm.com
766,ria.ru
767,histats.com
768,marketwatch.com
769,yandex.com.tr
770,staples.com
771,elfagr.org
772,totaladperformance.com
773,nhk.or.jp
774,fifa.com
775,click4stat.com
776,tomshardware.com
777,coupons.com
778,folha.uol.com.br
779,milanuncios.com
780,gemius.pl
781,usmagazine.com
782,primewire.ag
783,kdnet.net
784,wiktionary.org
785,zara.com
786,cbssports.com
787,cnblogs.com
788,wired.com
789,wayfair.com
790,tiexue.net
791,ted.com
792,freepik.com
793,sozcu.com.tr
794,yandex.kz
795,getpocket.com
796,auction.co.kr
797,usaa.com
798,researchgate.net
799,vi-view.com
800,google.lk
801,littlethings.com
802,www.gov.uk
803,europa.eu
804,32d1d3b9c.se
805,104.com.tw
806,nate.com
807,momoshop.com.tw
808,drtuber.com
809,novinky.cz
810,4chan.org
811,saramin.co.kr
812,behance.net
813,tsite.jp
814,2chblog.jp
815,geocities.jp
816,delta.com
817,ruten.com.tw
818,google.rs
819,coursera.org
820,acfun.tv
821,ehow.com
822,fandango.com
823,all2lnk.com
824,terra.com.br
825,mayoclinic.org
826,soku.com
827,aa.com
828,google.com.kw
829,goodgamestudios.com
830,yomiuri.co.jp
831,21cn.com
832,etao.com
833,promoads.net
834,pchome.com.tw
835,gutefrage.net
836,farsnews.com
837,agar.io
838,wav.tv
839,match.com
840,messenger.com
841,webex.com
842,trklnks.com
843,news.com.au
844,forever21.com
845,cbsnews.com
846,drom.ru
847,food.com
848,vk.me
849,facenama.com
850,filehippo.com
851,sky.com
852,usbank.com
853,atlassian.net
854,sapo.pt
855,sfgate.com
856,filmon-ads.com
857,admtpmp127.com
858,thepiratebay.am
859,popsugar.com
860,roblox.com
861,zappos.com
862,westernjournalism.com
863,lequipe.fr
864,pcpop.com
865,adp.com
866,oyunskor.com
867,norton.com
868,androidcentral.com
869,almasryalyoum.com
870,howtogeek.com
871,haberturk.com
872,reverso.net
873,upwork.com
874,ticketmaster.com
875,cpasbien.pw
876,biobiochile.cl
877,sulekha.com
878,istartsurf.com
879,vine.co
880,bluehost.com
881,ebates.com
882,mihanblog.com
883,buy.tmall.com
884,jin115.com
885,monster.com
886,ascii.jp
887,slimspots.com
888,dreamstime.com
889,cisco.com
890,126.com
891,pagesjaunes.fr
892,sciencedirect.com
893,gazzetta.it
894,gumtree.com
895,techradar.com
896,himado.in
897,sfr.fr
898,clixsense.com
899,yoka.com
900,t-mobile.com
901,nypost.com
902,indianexpress.com
903,topix.com
904,academia.edu
905,indiegogo.com
906,idnes.cz
907,lifebuzz.com
908,jcpenney.com
909,moz.com
910,tagged.com
911,lanacion.com.ar
912,cityadspix.com
913,entrepreneur.com
914,lun.com
915,hilton.com
916,eventbrite.com
917,prpops.com
918,blogspot.ru
919,olx.ua
920,carview.co.jp
921,watch-series-tv.to
922,quanjing.com
923,google.hr
924,yandex.by
925,vetogate.com
926,mit.edu
927,netteller.com
928,myfreecams.com
929,yellowpages.com
930,uber.com
931,thedailybeast.com
932,whitepages.com
933,blogspot.de
934,alfalfalfa.com
935,profitboosterapp.com
936,rakuten.ne.jp
937,gofundme.com
938,deviantart.net
939,state.gov
940,deezer.com
941,indiamart.com
942,123rf.com
943,tripadvisor.co.uk
944,mapquest.com
945,audible.com
946,marktplaats.nl
947,intel.com
948,masrawy.com
949,thekitchn.com
950,cocolog-nifty.com
951,dropbooks.tv
952,ultimate-guitar.com
953,anitube.se
954,ebay.ca
955,digg.com
956,sharepoint.com
957,porn.com
958,immobilienscout24.de
959,clarin.com
960,firstpost.com
961,marriott.com
962,blomaga.jp
963,indianrail.gov.in
964,prothom-alo.com
965,google.by
966,deadspin.com
967,wp.com
968,offpageads.com
969,clipconverter.cc
970,elance.com
971,informer.com
972,io9.com
973,hardsextube.com
974,lynda.com
975,investing.com
976,eenadu.net
977,sporx.com
978,ldblog.jp
979,infoseek.co.jp
980,p1mods.com
981,cbc.ca
982,blackboard.com
983,thepiratebay.mn
984,mtv.com
985,allocine.fr
986,alarabiya.net
987,livestrong.com
988,vox.com
989,irs.gov
990,barnesandnoble.com
991,focus.cn
992,bt.com
993,internethaber.com
994,excite.co.jp
995,gazeta.ru
996,dict.cc
997,2ch-c.net
998,inquirer.net
999,wattpad.com
1000,nu.nl"

checkDep() {
	for prog in "$@"; do
		command -v $prog >/dev/null 2>&1 || { echo "$prog is required, please install it first" >&2; exit 1; }
	done
}

checkDep grep dig cut expr

if [ -z $1 ]; then
	echo "syntax: $0 dns [host]"
	exit 1
fi

if [ -z $2 ]; then
	query=""
else
	query="$2"
fi

countRun=0
countSuccess=0
countFail=0
minTime=-1
averageTime=-1
maxTime=-1

trap 'echo && echo "--- $1 pingdns statistics ---" && echo "$countRun queries transmitted, $countSuccess queries answered, $countFail queries failed" && echo "round-trip min/avg/max = $minTime/$averageTime/$maxTime ms" && exit 0' INT TERM

echo "PINGDNS $1:"

while true; do
	countRun=`expr $countRun + 1`
	if [ -z $2 ]; then
		query=`echo "$hosts" | grep "^$((RANDOM%1000))," | cut -f2 -d","`
	fi
	res=`dig +tries=1 +noall +stats $query @$1 2>&1`
	if [ $? -eq 0 ]; then
		countSuccess=`expr $countSuccess + 1`
		resTime=`echo "$res" | grep "Query time:" | cut -f4 -d" "`
		if [ "$averageTime" == "-1" ]; then
			averageTime=$resTime
		else
			averageTime=`expr $averageTime + $resTime`
			averageTime=`expr $averageTime / 2`
		fi
		if [ "$minTime" == "-1" ]; then
			minTime=$resTime
		else
			if [ $minTime -gt $resTime ]; then
				minTime=$resTime
			fi
		fi
		if [ $maxTime -lt $resTime ]; then
			maxTime=$resTime
		fi
		echo "answer from $1: seq=$countRun query=$query time=$resTime ms"
	else
		countFail=`expr $countFail + 1`
		echo "Request timeout for seq $countRun"
	fi
done
